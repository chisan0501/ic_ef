
@{
    ViewBag.Title = "Retail_Dymo";
    Layout = "~/Views/Shared/_Layout.cshtml";

}

    <link href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css" rel="stylesheet" />
    <script src="~/Scripts/DataTables/jquery.dataTables.min.js"></script>
    <script src="~/js/DYMO.Label.Framework_2.0.js"></script>
    <script src="~/js/PrintLabel_retail.js"></script>
    <script src="~/js/PrintLabel_retail_custom.js"></script>
    <script src="~/js/moment.js"></script>





    <h2><i class="fa fa-building" aria-hidden="true"></i> Retail Label</h2>

    <br />



    <div class="container">
        <div class="row">
            <h4>Data : </h4>
            <div class="col-lg-12">
                <img id="loading" src="~/Content/spinner.gif" alt="Updating ..." style="display: none;" />
                <table class="table" id="table2">
                    <thead>
                        <tr>
                            <th>TimeStamp</th>
                            <th>Asset Tag</th>
                            <th>Model</th>
                            <th>CPU</th>
                            <th>RAM</th>
                            <th>HDD</th>
                            <th>Price</th>
                            <th>Channel</th>

                        </tr>
                    </thead>
                    <tbody></tbody>
                   
                </table>

            </div>
        </div>
        <div class="row">
            <div class="col-xs-3">

                <div class="panel panel-default">
                    <div class="panel-heading">Search By Asset Tag</div>
                    <div class="panel-body">
                        <div class="form-group">
                            <label for="search_input">Search Asset Tag:</label>
                            <input type="text" required class="form-control" id="search_input">
                            <label for="price_text">Price:</label>
                            <input type="text" class="form-control" id="price_text">
                            <label for="title_text">Channel:</label>
                            <input type="text" class="form-control" id="title_text" value="Mar">
                            <label for="time_text">Time:</label>
                            <input type="text" class="form-control" id="time_text">
                            <button type="submit" class="btn btn-default" id="submit_asset">Submit</button>
                           
                          <p><label for="non_custom_printersSelect">Select Printer:</label></p>
                            <p><select id="non_custom_printersSelect" class="form-control"></select></p>
                           
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">Search By Asset Tag(Mac Only)</div>
                    <div class="panel-body">
                        <div class="form-group">
                            <label for="search_input">Search Asset Tag:</label>
                            <input type="text" required class="form-control" id="search_input_mac">
                            <label for="price_text">Price:</label>
                            <input type="text" class="form-control" id="price_text_mac">
                            <label for="title_text">Channel:</label>
                            <input type="text" class="form-control" id="title_text_mac" value="Mar">
                            <label for="time_text">Time:</label>
                            <input type="text" class="form-control" id="time_text_mac">
                            <button type="submit" class="btn btn-default" id="submit_asset_mac">Submit</button>

                            

                        </div>
                    </div>
                </div>



            </div>

            <div class="col-xs-4">

                <div class="panel panel-default">
                    <div class="panel-heading">Create New Label</div>
                    <div class="panel-body">

                        <form role="form" id="create_group">

                            <label for="creat_asset_tag">Asset Tag:</label>
                            <input type="text" minlength="2" class="form-control" id="creat_asset_tag" required>
                            <label for="creat_model">Model:</label>
                            <input type="text" class="form-control" id="creat_model">
                            <label for="creat_cpu">CPU:</label>
                            <input type="text" class="form-control" id="creat_cpu">
                            <label for="creat_ram">RAM:</label>
                            <input type="text" class="form-control" id="creat_ram">
                            <label for="creat_hdd">HDD:</label>
                            <input type="text" class="form-control" id="creat_hdd">
                            <label for="creat_price">Price:</label>
                            <input type="text" class="form-control" id="creat_price">
                            <label for="creat_channel">Channel</label>
                            <input type="text" class="form-control" id="creat_channel" value="Mar">
                            <button type="button" id="submit_create" class="btn btn-default">Submit</button>
                            <p><label for="printersSelect">Select Printer:</label></p>
                            <p><select id="printersSelect" class="form-control"></select></p>
                           

                        </form>
                        <input type="button" value="Print" class="form-control" disabled="disabled" id="printButton" />
                    </div>
                </div>


            </div>
            <div class="col-xs-5">
                <div class="panel panel-default">
                    <div class="panel-heading">History 
                        <button type="button" id="refresh_btn" class="btn btn-default">Refresh</button>
                
                    <ul>
                     
                      
                     
                        <li>
                            <svg width="80" height="20">
                                <rect width="80" height="20" style="fill:rgb(76, 255, 0);stroke-width:3;stroke:rgb(0,0,0)">
                                    Sorry, your browser does not support inline SVG.
                            </svg> < 14 Days
                        </li>

                        <li>
                            <svg width="80" height="20">
                                <rect width="80" height="20" style="fill:rgb(255,255,0);stroke-width:3;stroke:rgb(0,0,0)">
                                    Sorry, your browser does not support inline SVG.
                            </svg> 15 to 22 Days
                        </li>
                        <li>
                            <svg width="80" height="20">
                                <rect width="80" height="20" style="fill:rgb(255,0,0);stroke-width:3;stroke:rgb(0,0,0)">
                                    Sorry, your browser does not support inline SVG.
                            </svg> > 23 Days +
                        </li>
                    </ul>
                     
                    <input type="text"  placeholder="Enter Asset # for Removal" class="form-control" id="remove_input"><button class='form-control' id='sold'>Sold</button>
                   
                    </div>
                    <div class="panel-body">
                        <table class="table" id="table_reminder">
                            <thead>
                                <tr>

                                    <th>Asset #</th>
                                    <th>Model</th>
                                    <th>$</th>
                                    <th>Days</th>

                                </tr>
                            </thead>
                            <tbody></tbody>
                            
                        </table>
                        </div>
                    </div>
                
                    </div>
                </div>


            </div>


    <script>
        $(document).ready(function () {
           
            function fetch_histroy_list() {
                $.ajax({
                    url: '@Url.Action("json_Retail_Dymo", "Dymo")',
                    type: "GET",
                    success: function (result) {

                        var tr;

                        for (var i = 0; i < result.item.length; i++) {
                            tr += '<tr>';
                            tr += '<td>' + result.item[i].asset_tag + '</td>';
                            tr += '<td>' + result.item[i].model + '</td>';
                            tr += '<td>' + result.item[i].price + '</td>';
                            
                            var days = result.days[i];
                            if (days <= 14) {
                                tr += "<td bgcolor='#40FF00'>" + days + "</td>";
                            }
                            else if (days >= 15 && days <= 22) {
                                tr += "<td bgcolor='#FFFF00'>" + days + "</td>";                                
                            }
                            else if (days >= 23 && days <= 31) {
                                tr += "<td bgcolor='#FF0000'>" + days + "</td>";                             
                            }
                            else {
                                tr += "<td>" + days + "</td>";
                            }
                           
                            tr += '</tr>';
                            
                            
                            //tr += "<td><button class='form-control'  id='sold'>Sold</button> </td>";

                          
                        }

                        $('#table_reminder tbody').html(tr);
                        $('#table_reminder').DataTable();
                    }
           
                });
            }
            
            fetch_histroy_list();
            
            var d = new Date();
            var n = d.getTime();
            var responseDate = moment(n).format('YYYY-MM-DD');
            $("#time_text").val(responseDate);
            $("#time_text_mac").val(responseDate);
            $('body').on('click', '#editbtn', function () {
                var currentTD = $(this).parents('tr').find('td');

                if ($(this).html() == 'Edit') {
                    $.each(currentTD, function () {
                        $(this).prop('contenteditable', true)
                    });
                } else {
                    $.each(currentTD, function () {
                        $(this).prop('contenteditable', false)
                    });
                }
                $(this).html($(this).html() == 'Edit' ? 'Save' : 'Edit')
              })
            $("#show_sample").click(function () {
                $('#sampel_pic').toggle();
            })

            $("#refresh_btn").click(function () {
                $("#table_reminder tr:gt(0)").remove();
                fetch_histroy_list();
            })

            $('body').on('click', '#sold', function () {
                //var x = $(this).closest('tr').index();
                //var asset_tag = document.getElementById("table_reminder").rows[x+1].cells[0].innerHTML;
                var asset_tag = $('#remove_input').val();
                var isSold = "YES";
                var jsonObject = { "asset": asset_tag, isSold : isSold }
                $.ajax({
                    url: "@Url.Action("mark_sold")",
                    type: "POST",
                data: JSON.stringify(jsonObject),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {


                    //write code here manage "data"
                },
                error: function () {

                    $("#result").html('there is error while submit');
                }

                });
                document.getElementById("table_reminder").deleteRow(x+1);
            });

            $("#submit_create").click(function () {
                $('#loading').show();
                var asset = $("#creat_asset_tag").val();
                var model = $("#creat_model").val();
                var cpu = $("#creat_cpu").val();
                var ram = $("#creat_ram").val();
                var hdd = $("#creat_hdd").val();
                var price = $("#creat_price").val();

                var jsonObject = {
                    "asset": asset,
                    "model": model,
                    "cpu": cpu,
                    "ram": ram,
                    "hdd": hdd,
                    "price": price
                };
                $.ajax({
                    url: "@Url.Action("create_dymo")",
                    type: "POST",
                    data: JSON.stringify(jsonObject),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        $('#loading').hide();
                        $('#printButton').removeAttr('disabled');
                        //write code here manage "data"
                    },
                    error: function () {
                        $('#loading').hide();
                        $('#printButton').attr('disabled', 'disabled');
                        alert("Please Make Sure all 'Create New Label' Fields are fill in");

                        $("#result").html('there is error while submit');
                    }

                });

            });
            $("#submit_asset").click(function () {
                $('#loading').show();

                var asset = $("#search_input").val();
                var price = $("#price_text").val();
                var channel = $("#title_text").val();

                $.getJSON('@Url.Action("RetailDymo")', {
                    asset: asset,
                    price : price
                })
                .done(function (data) {

                    $('#loading').hide();


                    var tr;
                        
                
                        tr = $('<tr/>');
                        tr.append("<td>" + responseDate + "</td>");
                        tr.append("<td>" + data.result.ictag + "</td>");
                        tr.append("<td>" + data.result.model + "</td>");
                        tr.append("<td>" + data.result.cpu + "</td>");
                        tr.append("<td>" + data.ram + "</td>");
                        tr.append("<td>" + data.hdd + "</td>");

                        tr.append("<td>" + price + "</td>");
                        tr.append("<td>" + channel + "</td>");
                        tr.append("<td><button class='form-control' id='editbtn'>Edit</button></td>");
                        tr.append("<td><input type='button' value='Print' class='form-control' id='non_custom_printButton'/> </button></td>");

                        $("#table2").append(tr);
                        


                })

               .fail(function (jqxhr, textStatus, error) {
                   var err = textStatus + ", " + error;
                   console.log("Asset Not Found: " + err);
               });

            });
            
            $("#submit_asset_mac").click(function () {
                $('#loading').show();

                var asset = $("#search_input_mac").val();
                var price = $("#price_text_mac").val();
                var channel = $("#title_text_mac").val();

                $.getJSON('@Url.Action("RetailDymo_mac")', {
                    asset: asset,
                    price: price
                })
                .done(function (data) {

                    $('#loading').hide();


                    var tr;


                    tr = $('<tr/>');
                    tr.append("<td>" + responseDate + "</td>");
                    tr.append("<td>" + data.result.ictags + "</td>");
                    tr.append("<td>" + data.result.Model + "</td>");
                    tr.append("<td>" + data.result.cpu + "</td>");
                    tr.append("<td>" + data.ram + "</td>");
                    tr.append("<td>" + data.hdd + "</td>");

                    tr.append("<td>" + price + "</td>");
                    tr.append("<td>" + channel + "</td>");
                    tr.append("<td><button class='form-control' id='editbtn'>Edit</button></td>");
                    tr.append("<td><input type='button' value='Print' class='form-control' id='non_custom_printButton'/> </button></td>");

                    $("#table2").append(tr);



                })

               .fail(function (jqxhr, textStatus, error) {
                   var err = textStatus + ", " + error;
                   console.log("Asset Not Found: " + err);
               });

            });

        });

    </script>


